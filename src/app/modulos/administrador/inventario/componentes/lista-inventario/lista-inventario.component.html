<div class="inventario-container">
  
  <!-- ========================================
       HEADER
  ======================================== -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">üìä Gesti√≥n de Inventario</h1>
      <p class="page-subtitle">Control y seguimiento de stock</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="cargarDatos()">
        <span class="btn-icon">üîÑ</span>
        <span>Actualizar</span>
      </button>
    </div>
  </div>

  <!-- ========================================
       PANEL DE ESTAD√çSTICAS
  ======================================== -->
  @if (estadisticas()) {
    <div class="estadisticas-grid">
      
      <div class="estadistica-card">
        <div class="estadistica-icon">üì¶</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">{{ estadisticas()!.total_productos }}</span>
          <span class="estadistica-label">Total Productos</span>
        </div>
      </div>

      <div class="estadistica-card">
        <div class="estadistica-icon">üí∞</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">S/ {{ estadisticas()!.valor_total_inventario | number:'1.2-2' }}</span>
          <span class="estadistica-label">Valor Total</span>
        </div>
      </div>

      <div class="estadistica-card critico">
        <div class="estadistica-icon">üö®</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">{{ estadisticas()!.productos_stock_critico }}</span>
          <span class="estadistica-label">Stock Cr√≠tico</span>
        </div>
      </div>

      <div class="estadistica-card bajo">
        <div class="estadistica-icon">‚ö†Ô∏è</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">{{ estadisticas()!.productos_stock_bajo }}</span>
          <span class="estadistica-label">Stock Bajo</span>
        </div>
      </div>

      <div class="estadistica-card normal">
        <div class="estadistica-icon">‚úÖ</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">{{ estadisticas()!.productos_stock_normal }}</span>
          <span class="estadistica-label">Stock Normal</span>
        </div>
      </div>

      <div class="estadistica-card exceso">
        <div class="estadistica-icon">üìà</div>
        <div class="estadistica-content">
          <span class="estadistica-valor">{{ estadisticas()!.productos_exceso }}</span>
          <span class="estadistica-label">Stock Exceso</span>
        </div>
      </div>

    </div>
  }

  <!-- ========================================
       ALERTAS R√ÅPIDAS
  ======================================== -->
  <div class="alertas-grid">
    @if (productosStockCritico() > 0) {
      <div class="alerta alerta-critico">
        <span class="alerta-icon">üö®</span>
        <div class="alerta-content">
          <span class="alerta-numero">{{ productosStockCritico() }}</span>
          <span class="alerta-texto">productos en estado cr√≠tico</span>
        </div>
      </div>
    }
    
    @if (productosStockBajo() > 0) {
      <div class="alerta alerta-bajo">
        <span class="alerta-icon">‚ö†Ô∏è</span>
        <div class="alerta-content">
          <span class="alerta-numero">{{ productosStockBajo() }}</span>
          <span class="alerta-texto">productos con stock bajo</span>
        </div>
      </div>
    }
  </div>

  <!-- ========================================
       FILTROS
  ======================================== -->
  <div class="filtros-container">
    <div class="filtros-grid">
      
      <!-- B√∫squeda -->
      <div class="filtro-item filtro-busqueda">
        <label>
          <span class="filtro-icon">üîç</span>
          Buscar producto
        </label>
        <input 
          type="text" 
          class="filtro-input"
          placeholder="Por nombre o c√≥digo..."
          [(ngModel)]="filtrosActivos().busqueda"
          (input)="aplicarFiltros(filtrosActivos())"
        >
      </div>

      <!-- Categor√≠a -->
      <div class="filtro-item">
        <label>Categor√≠a</label>
        <select 
          class="filtro-select"
          [(ngModel)]="filtrosActivos().categoria"
          (change)="aplicarFiltros(filtrosActivos())"
        >
          @for (cat of categorias; track cat) {
            <option [value]="cat === 'Todas' ? '' : cat">{{ cat }}</option>
          }
        </select>
      </div>

      <!-- Estado de Stock -->
      <div class="filtro-item">
        <label>Estado de Stock</label>
        <select 
          class="filtro-select"
          [(ngModel)]="filtrosActivos().estado_stock"
          (change)="aplicarFiltros(filtrosActivos())"
        >
          <option value="">Todos</option>
          @for (estado of estadosStock; track estado.valor) {
            <option [value]="estado.valor">{{ estado.texto }}</option>
          }
        </select>
      </div>

      <!-- Ordenar por -->
      <div class="filtro-item">
        <label>Ordenar por</label>
        <select 
          class="filtro-select"
          [(ngModel)]="filtrosActivos().orden"
          (change)="aplicarFiltros(filtrosActivos())"
        >
          @for (orden of ordenamiento; track orden.valor) {
            <option [value]="orden.valor">{{ orden.texto }}</option>
          }
        </select>
      </div>

      <!-- Bot√≥n Limpiar -->
      <div class="filtro-item filtro-boton">
        <button 
          class="btn-limpiar"
          (click)="limpiarFiltros()"
        >
          Limpiar
        </button>
      </div>

    </div>
  </div>

  <!-- ========================================
       LOADING
  ======================================== -->
  @if (cargando()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando inventario...</p>
    </div>
  }

  <!-- ========================================
       TABLA DE INVENTARIO
  ======================================== -->
  @if (!cargando() && productos().length > 0) {
    <div class="table-container">
      <table class="table-inventario">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Tipo/Color</th>
            <th>Stock Actual</th>
            <th>Stock M√≠nimo</th>
            <th>Estado</th>
            <th>Precio Unit.</th>
            <th>Valor Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (producto of productos(); track producto.id) {
            <tr [class.fila-critico]="producto.estado_stock === 'critico'">
              
              <!-- C√≥digo -->
              <td class="producto-codigo">{{ producto.codigo_lana }}</td>

              <!-- Nombre -->
              <td>
                <div class="producto-info">
                  <span class="producto-nombre">{{ producto.nombre }}</span>
                </div>
              </td>

              <!-- Categor√≠a -->
              <td>
                <span class="badge badge-secondary">{{ producto.categoria }}</span>
              </td>

              <!-- Tipo/Color -->
              <td>
                <div class="producto-detalle">
                  <span class="producto-tipo">{{ producto.tipo_lana }}</span>
                  <span class="producto-color">{{ producto.color }}</span>
                </div>
              </td>

              <!-- Stock Actual -->
              <td>
                <div class="stock-actual">
                  <span class="stock-numero" [class.stock-critico]="producto.estado_stock === 'critico'">
                    {{ producto.stock }}
                  </span>
                  <span class="stock-unidad">unid.</span>
                </div>
              </td>

              <!-- Stock M√≠nimo -->
              <td class="text-muted">{{ producto.stock_minimo }} unid.</td>

              <!-- Estado -->
              <td>
                <span 
                  class="badge" 
                  [ngClass]="getStockBadgeClass(producto.estado_stock)"
                >
                  {{ getEstadoTexto(producto.estado_stock) }}
                </span>
              </td>

              <!-- Precio -->
              <td class="precio">S/ {{ producto.precio_unitario | number:'1.2-2' }}</td>

              <!-- Valor Total -->
              <td class="valor-total">S/ {{ producto.valor_total | number:'1.2-2' }}</td>

              <!-- Acciones -->
              <td>
                <div class="action-buttons">
                  <button 
                    class="btn-icon btn-ajustar" 
                    (click)="abrirModalAjuste(producto)"
                    title="Ajustar stock"
                  >
                    üîß
                  </button>
                  <button 
                    class="btn-icon btn-historial" 
                    (click)="abrirHistorial(producto)"
                    title="Ver historial"
                  >
                    üìú
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Footer de la tabla -->
      <div class="table-footer">
        <div class="footer-info">
          <span>Total de productos: <strong>{{ productos().length }}</strong></span>
          <span class="separator">|</span>
          <span>Valor total del inventario: <strong>S/ {{ valorTotalInventario() | number:'1.2-2' }}</strong></span>
        </div>
      </div>
    </div>
  }

  <!-- ========================================
       ESTADO VAC√çO
  ======================================== -->
  @if (!cargando() && productos().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>No hay productos en el inventario</h3>
      <p>No se encontraron productos con los filtros seleccionados</p>
      <button class="btn-primary" (click)="limpiarFiltros()">
        Limpiar Filtros
      </button>
    </div>
  }

</div>