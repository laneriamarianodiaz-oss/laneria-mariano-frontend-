<!-- ============================================ -->
<!-- NUEVO HTML: cambiar-estado-pedido.component.html -->
<!-- ============================================ -->

<div class="cambiar-estado-container">
  
  <!-- Estado Actual - Card Grande -->
  <div class="estado-actual-grande">
    <div class="estado-actual-header">
      <h3>Estado Actual del Pedido</h3>
    </div>
    <div class="estado-actual-body">
      <div class="estado-badge-grande" [ngClass]="getBadgeClass(estadoActualInfo.color)">
        <span class="estado-icono-grande">{{ estadoActualInfo.icono }}</span>
        <div class="estado-texto-grande">
          <span class="estado-nombre">{{ estadoActualInfo.texto }}</span>
          <span class="estado-descripcion">{{ estadoActualInfo.descripcion }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Acciones Disponibles - Grid de Cards -->
  <div class="acciones-container" *ngIf="puedeActualizar">
    <h3 class="acciones-titulo">
      <span class="icono-titulo">üîÑ</span>
      Cambiar Estado del Pedido
    </h3>
    <p class="acciones-subtitulo">Selecciona el nuevo estado para actualizar el pedido</p>
    
    <div class="estados-grid">
      <div 
        *ngFor="let estado of estadosDisponibles"
        class="estado-card"
        [ngClass]="getCardClass(estado.color)"
        (click)="abrirModal(estado.valor)">
        
        <div class="estado-card-header">
          <span class="estado-card-icono">{{ estado.icono }}</span>
        </div>
        
        <div class="estado-card-body">
          <h4 class="estado-card-titulo">{{ estado.texto }}</h4>
          <p class="estado-card-descripcion">{{ estado.descripcion }}</p>
        </div>
        
        <div class="estado-card-footer">
          <button class="btn-cambiar" [ngClass]="'btn-' + estado.color">
            Cambiar a este estado ‚Üí
          </button>
        </div>
        
        <div class="estado-card-hover-effect"></div>
      </div>
    </div>
  </div>

  <!-- Mensaje Estado Final -->
  <div class="estado-final-card" *ngIf="!puedeActualizar">
    <div class="estado-final-icono" *ngIf="estadoActual === 'Completado'">
      <span class="icono-grande">‚úÖ</span>
    </div>
    <div class="estado-final-icono" *ngIf="estadoActual === 'Cancelado'">
      <span class="icono-grande">‚ùå</span>
    </div>
    
    <div class="estado-final-texto">
      <h3 *ngIf="estadoActual === 'Completado'">Pedido Completado</h3>
      <h3 *ngIf="estadoActual === 'Cancelado'">Pedido Cancelado</h3>
      
      <p *ngIf="estadoActual === 'Completado'">
        Este pedido ha sido completado exitosamente. No se pueden realizar m√°s cambios.
      </p>
      <p *ngIf="estadoActual === 'Cancelado'">
        Este pedido fue cancelado. No se pueden realizar m√°s cambios.
      </p>
    </div>
  </div>

</div>

<!-- Modal de Confirmaci√≥n Mejorado -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content-mejorado" (click)="$event.stopPropagation()">
    
    <div class="modal-header-mejorado">
      <div class="modal-header-icon">
        <span>üîÑ</span>
      </div>
      <div class="modal-header-texto">
        <h3>Confirmar Cambio de Estado</h3>
        <p>Est√°s a punto de actualizar el estado del pedido</p>
      </div>
      <button class="btn-cerrar-mejorado" (click)="cerrarModal()">
        <span>√ó</span>
      </button>
    </div>

    <div class="modal-body-mejorado">
      
      <!-- Visualizaci√≥n del Cambio -->
      <div class="cambio-visual">
        <div class="cambio-desde">
          <span class="cambio-label">Estado Actual</span>
          <div class="cambio-badge" [ngClass]="getBadgeClass(estadoActualInfo.color)">
            <span class="cambio-icono">{{ estadoActualInfo.icono }}</span>
            <span class="cambio-texto">{{ estadoActualInfo.texto }}</span>
          </div>
        </div>
        
        <div class="cambio-flecha">
          <div class="flecha-animada">
            <span>‚Üí</span>
            <span>‚Üí</span>
            <span>‚Üí</span>
          </div>
        </div>
        
        <div class="cambio-hasta">
          <span class="cambio-label">Nuevo Estado</span>
          <div class="cambio-badge cambio-badge-nuevo" 
               [ngClass]="getBadgeClass(obtenerInfoEstadoSeleccionado()?.color || 'primary')">
            <span class="cambio-icono">{{ obtenerInfoEstadoSeleccionado()?.icono }}</span>
            <span class="cambio-texto">{{ obtenerInfoEstadoSeleccionado()?.texto }}</span>
          </div>
        </div>
      </div>

      <!-- Descripci√≥n del nuevo estado -->
      <div class="nuevo-estado-info">
        <div class="info-icon">‚ÑπÔ∏è</div>
        <div class="info-texto">
          <strong>{{ obtenerInfoEstadoSeleccionado()?.texto }}</strong>
          <p>{{ obtenerInfoEstadoSeleccionado()?.descripcion }}</p>
        </div>
      </div>

      <!-- Campo de Observaciones -->
      <div class="form-group-mejorado">
        <label for="observaciones">
          <span class="label-icon">üìù</span>
          {{ estadoSeleccionado === 'Cancelado' ? 'Motivo de cancelaci√≥n *' : 'Observaciones (opcional)' }}
        </label>
        <textarea
          id="observaciones"
          [(ngModel)]="observaciones"
          rows="4"
          class="textarea-mejorado"
          [placeholder]="estadoSeleccionado === 'Cancelado' ? 'Ingresa el motivo de la cancelaci√≥n...' : 'Agrega observaciones sobre este cambio (opcional)...'"
          [required]="estadoSeleccionado === 'Cancelado'">
        </textarea>
        <span class="textarea-contador">{{ observaciones.length }} caracteres</span>
      </div>

      <!-- Alerta para Cancelaci√≥n -->
      <div class="alerta-cancelacion" *ngIf="estadoSeleccionado === 'Cancelado'">
        <div class="alerta-icon">‚ö†Ô∏è</div>
        <div class="alerta-texto">
          <strong>¬°Atenci√≥n!</strong>
          <p>Esta acci√≥n no se puede deshacer. El pedido ser√° marcado como cancelado permanentemente.</p>
        </div>
      </div>

    </div>

    <div class="modal-footer-mejorado">
      <button class="btn-modal btn-cancelar" (click)="cerrarModal()">
        <span class="btn-icon">‚Üê</span>
        <span>Cancelar</span>
      </button>
      <button class="btn-modal btn-confirmar" (click)="confirmarCambio()">
        <span>Confirmar Cambio</span>
        <span class="btn-icon">‚úì</span>
      </button>
    </div>

  </div>
</div>